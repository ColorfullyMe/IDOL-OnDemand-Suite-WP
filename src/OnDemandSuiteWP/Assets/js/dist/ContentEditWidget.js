!function(angular,_){angular.element(document).ready(function(){var app_container=document.getElementById("ContentEditWidget_GUI");0==ODSWP_ContentEditWidget.error?angular.bootstrap(app_container,["ODSWP_ContentEditWidget"]):angular.element(document.getElementById("ODSWP_Root")).addClass("ODSWP_Error").html(ODSWP_ContentEditWidget.error_txt)});var app=angular.module("ODSWP_ContentEditWidget",["ngModal","ngAnimate","angularFileUpload"]);app.config(function(ngModalDefaultsProvider){ngModalDefaultsProvider.set("closeButtonHtml",'<i class="fa fa-times"></i>')}),app.directive("tabs",function(){return{restrict:"E",transclude:!0,scope:{publishTo:"=",name:"@"},controller:function($scope){var panes=$scope.panes=[];$scope.select=function(pane){angular.forEach(panes,function(pane){pane.selected=!1}),pane.selected=!0,$scope.publishTo&&angular.isObject($scope.publishTo)&&$scope.name&&($scope.publishTo.tabs=$scope.publishTo.tabs||{},$scope.publishTo.tabs[$scope.name]=$scope.publishTo.tabs[$scope.name]||{},$scope.publishTo.tabs[$scope.name].selected=pane.title)},$scope.$watch("publishTo",function(newVal,oldVal){newVal&&angular.isObject(newVal)&&!oldVal&&$scope.name&&(newVal.tabs={},newVal.tabs[$scope.name]={},$scope.select($scope.panes[0]))}),this.addPane=function(pane){0==panes.length&&$scope.select(pane),panes.push(pane)}},template:'<div class="ODSWP_tabbable"><ul class="tabs"><li ng-repeat="pane in panes" ng-class="{tab_active:pane.selected}"><a href="" ng-click="select(pane)">{{pane.title}}</a></li></ul><div class="tab-content" ng-transclude></div></div>',replace:!0}}).directive("pane",function(){return{require:"^tabs",restrict:"E",transclude:!0,scope:{title:"@"},link:function(scope,element,attrs,tabsCtrl){tabsCtrl.addPane(scope)},template:'<div class="tab-pane" ng-class="{pane_active: selected}" ng-transclude></div>',replace:!0}}),app.controller("ODSWP_Root",["$scope","$http","$upload",function($scope,$http){window.OCRDoc=$scope,$scope.modal={set:function(p,v){this[p]=v}},$scope.modal_pop=angular.bind($scope.modal,function(name,e){e&&(e.stopPropagation(),e.preventDefault()),this.currentTpl=name,this.show=!0,this.preventClose=!1,this.resetOnClose=!0}),$scope.OCRDoc={},$scope.OCR_image=angular.bind($scope.OCRDoc,function(){if(!this.ctask){switch(this.tabs.src.selected){case"Reference":if(!this[this.tabs.src.selected])return alert("Please, provide some HP IDOL OnDemand reference..."),void 0;break;case"Url":if(!/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(this[this.tabs.src.selected]))return alert("Invalid URL!"),void 0}this.res=null,this.error=null;var _this=this;this.ctask=$scope.ctask="OCR Image is executing...",$http.post("admin-ajax.php",{task:"OCRImage",src:this.tabs.src.selected,value:this[this.tabs.src.selected],mode:this.mode},{params:{action:"ODSWP_ContentEditWidget",nonce:ODSWP_ContentEditWidget.nonce}}).then(function(data){_this.ctask=$scope.ctask=null,_this.res=data.data,$scope.modal_pop("ok.ocrimage.html"),_this.useIt=_this.useIt||function(how){var result=_.chain(_this.res.text_block).pluck("text").join().value();switch(how){case"append":tinyMCE.activeEditor.dom.add(tinyMCE.activeEditor.getBody(),"p",null,result);break;case"prepend":tinyMCE.activeEditor.setContent(result+tinyMCE.activeEditor.getContent());break;case"replace":tinyMCE.activeEditor.setContent(result)}$scope.modal.set("show",!1)}},function(error){_this.ctask=$scope.ctask=null,_this.error=error.data.errorTxt,$scope.modal_pop("ok.ocrimage.html")})}}),$scope.Sntm={},$scope.SntmGo=angular.bind($scope.Sntm,function(){if(!this.ctask){switch(this.tabs.src.selected){case"Text":if(this.fromEditor&&!tinyMCE.activeEditor.getContent())return alert("Please, type something into the editor to analize..."),void 0;if(!this.fromEditor&&!this[this.tabs.src.selected])return alert("Please, provide some text to analize..."),void 0;break;case"Reference":if(!this[this.tabs.src.selected])return alert("Please, provide some HP IDOL OnDemand reference..."),void 0;break;case"Url":if(!/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(this[this.tabs.src.selected]))return alert("Invalid URL!"),void 0}this.res=null,this.error=null;var _this=this;this.ctask=$scope.ctask="Sentiment is executing...",$http.post("admin-ajax.php",{task:"SntmText",src:this.tabs.src.selected,value:"Text"==this.tabs.src.selected&&this.fromEditor?tinyMCE.activeEditor.getContent():this[this.tabs.src.selected],language:this.language},{params:{action:"ODSWP_ContentEditWidget",nonce:ODSWP_ContentEditWidget.nonce}}).then(function(data){_this.ctask=$scope.ctask=null,_this.res=data.data,$scope.modal_pop("ok.sentiment.html")},function(error){_this.ctask=$scope.ctask=null,_this.error=error.data.errorTxt,$scope.modal_pop("ok.sentiment.html")})}}),$scope.HghLig={start_tag:'<span style="background-color: yellow">'},$scope.HghLigGo=angular.bind($scope.HghLig,function(){if(!this.ctask){switch(this.tabs.src.selected){case"Text":if(this.fromEditor&&!tinyMCE.activeEditor.getContent())return alert("Please, type something into the editor to get it highlighted..."),void 0;if(!this.fromEditor&&!this[this.tabs.src.selected])return alert("Please, provide some text to highlight..."),void 0;break;case"Reference":if(!this[this.tabs.src.selected])return alert("Please, provide some HP IDOL OnDemand reference..."),void 0;break;case"Url":if(!/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(this[this.tabs.src.selected]))return alert("Invalid URL!"),void 0}if(!this.highlight_expression)return alert("Please, provide some expression to use for highlight..."),void 0;this.res=null,this.error=null;var _this=this;this.ctask=$scope.ctask="Highlight is executing...",$http.post("admin-ajax.php",{task:"HghLigText",src:this.tabs.src.selected,value:"Text"==this.tabs.src.selected&&this.fromEditor?tinyMCE.activeEditor.getContent():this[this.tabs.src.selected],highlight_expression:this.highlight_expression,start_tag:this.start_tag},{params:{action:"ODSWP_ContentEditWidget",nonce:ODSWP_ContentEditWidget.nonce}}).then(function(data){_this.ctask=$scope.ctask=null,_this.res=data.data.text,$scope.modal_pop("ok.highlight.html"),_this.useIt=_this.useIt||function(how){var result=_this.res;switch(how){case"append":tinyMCE.activeEditor.dom.add(tinyMCE.activeEditor.getBody(),"p",null,result);break;case"prepend":tinyMCE.activeEditor.setContent(result+tinyMCE.activeEditor.getContent());break;case"replace":tinyMCE.activeEditor.setContent(result)}$scope.modal.set("show",!1)}},function(error){_this.ctask=$scope.ctask=null,_this.error=error.data.errorTxt,$scope.modal_pop("ok.highlight.html")})}})}])}(angular,_);
