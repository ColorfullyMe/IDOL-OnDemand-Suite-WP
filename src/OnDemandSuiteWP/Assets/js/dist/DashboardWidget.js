!function(angular,_){angular.element(document).ready(function(){var app_container=document.getElementById("ODSWP_DashboardWidget");0==ODSWP_DashboardWidget.error?angular.bootstrap(app_container,["ODSWP_DashboardWidget"]):angular.element(document.getElementById("ODSWP_Root")).addClass("ODSWP_Error").html(ODSWP_DashboardWidget.error_txt)});var app=angular.module("ODSWP_DashboardWidget",["ngModal","ngAnimate"]);app.config(function(ngModalDefaultsProvider){ngModalDefaultsProvider.set("closeButtonHtml",'<i class="fa fa-times"></i>')}),app.controller("ODSWP_Root",["$scope","$http",function($scope,$http){$scope.remote_indexes=angular.copy(ODSWP_DashboardWidget.data),$scope.$on("uindex_created",function(e,data){$scope.remote_indexes.index.push(data)}),$scope.$on("uindex_deleted",function(e,data){_.remove($scope.remote_indexes.index,{index:data.index})}),$scope.toDate=function(str){return new Date(str)},$scope.modal={set:function(p,v){this[p]=v}},$scope.modal_pop=angular.bind($scope.modal,function(name,e){e&&(e.stopPropagation(),e.preventDefault()),this.currentTpl=name,this.show=!0,this.preventClose=!1,this.resetOnClose=!0}),$scope.uindex_task=function(task,click_data){if(!$scope.ctask)switch(task){case"status":$scope.ctask="Getting status of `"+click_data.uindex+"` index...",$http.post("admin-ajax.php",{task:task,uindex:click_data.uindex},{params:{action:"ODSWP_DashboardWidget",nonce:ODSWP_DashboardWidget.nonce}}).then(function(data){$scope.ctask=null,$scope.modal.data=data.data,$scope.modal.data.uindex=click_data.uindex,$scope.modal_pop("uindex.status.html")},function(error){$scope.ctask=null,$scope.modal.data=error.data,$scope.modal.data.title="`"+click_data.uindex+"` get status error",$scope.modal_pop("dashboard.widget.error.html")});break;case"add_doc":alert("Comming soon...");break;case"drop_doc":alert("Comming soon...");break;case"uindex_drop":$scope.ctask="Marking index `"+click_data.uindex+"` for delete...",$http.post("admin-ajax.php",{task:task,uindex:click_data.uindex},{params:{action:"ODSWP_DashboardWidget",nonce:ODSWP_DashboardWidget.nonce}}).then(function(data){$scope.ctask=null,$scope.modal.data=data.data,$scope.modal.data.uindex=click_data.uindex,$scope.modal_pop("uindex.delete.html"),console.log(data)},function(error){$scope.ctask=null,$scope.modal.data=error.data,$scope.modal.data.title="`"+click_data.uindex+"` delete error",$scope.modal_pop("dashboard.widget.error.html")})}},$scope.uindex_delete=function(){$scope.modal.set("preventClose",!0),$scope.modal.data.dropping=!0,$http.post("admin-ajax.php",{task:"uindex_drop_confirm",confirm:$scope.modal.data.confirm,uindex:$scope.modal.data.uindex},{params:{action:"ODSWP_DashboardWidget",nonce:ODSWP_DashboardWidget.nonce}}).then(function(data){console.log(data),$scope.modal.data.deleted="Success.",$scope.modal.set("preventClose",!1),$scope.$emit("uindex_deleted",{index:$scope.modal.data.uindex})},function(error){$scope.modal.data.errored=error.data.errorTxt,$scope.modal.set("preventClose",!1)})}}]),app.controller("uindex_create_form",["$scope","$http",function($scope,$http){$scope.checkForMatch=function(){$scope.uindex_match=-1!=_.findIndex(ODSWP_DashboardWidget.data.index,{index:$scope.index})?!0:!1},$scope.uindex_create=function(){$scope.uindex_match||$scope.working||($scope.working=!0,$scope.$parent.modal.set("preventClose",!0),$http.post("admin-ajax.php",{task:"uindex_create",uindex:$scope.index,flavor:$scope.flavor,desc:$scope.desc},{params:{action:"ODSWP_DashboardWidget",nonce:ODSWP_DashboardWidget.nonce}}).then(function(data){$scope.working=!1,$scope.$parent.modal.set("preventClose",!1),$scope.created="`"+data.data.index+"` created successfully.",$scope.$emit("uindex_created",{index:$scope.index,flavor:$scope.flavor,desc:$scope.desc,date_created:_.now(),type:"unknown"})},function(error){$scope.working=!1,$scope.$parent.modal.set("preventClose",!1),$scope.errored=error.data.errorTxt}))}}])}(angular,_);
